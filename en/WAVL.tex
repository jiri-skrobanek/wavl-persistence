

\section{Original Weak AVL tree}

\begin{defn}
A binary tree is said to be {\em ranked binary tree} if all vertices have non-negative integer ranks assigned. External vertices are by convention given rank $-1$. We denote $r(V)$ the rank of vertex $V$.
\end{defn}

\begin{defn}
Vertex $V$ having left child $L$ and right child $R$ (both of which may be external) in ranked binary tree is called $(a,b)$-vertex if $r(V) - r(L) = a$ and $r(V) - r(L) = b$. $L$ and $R$ are called $a$-child and $b$-child.
\end{defn}

\begin{thm}
Let $S$ be a finite subset of ${(\mathbb{Z} _ +)}^2$ and $T$ a ranked tree with $n$ vertices. If it holds that for every $(i,j)$-vertex in $T$ that $(i,j) \in S$, then the height of $T$ is $\Theta(\log n)$.
\label{thm-rbt-depth}
\end{thm}

\begin{myproof}
Let us denote $m$ the maximum allowed rank difference by $S$.
We prove this by induction on the rank of the root vertex. We establish a lower bound on the number of vertices in a tree with root of rank $r$. 
We suppose that it holds for every lower rank $q$, that the number of vertices in a tree with root of rank $q$ is at least $\exp(qc)$ for some positive constant $c$. 
Then to continue the induction we need the following: $$ 1 + 2\exp((r-m)c) \geq \exp(rc) $$ $$ \log 2 + (r-m)c \geq rc $$ $$ \log 2 \geq cm $$
We see that setting $c$ will be always possible.
The base case of rank zero: The inequality obviously holds for leaves (only possible vertices with rank zero).\\
Then $n \geq \exp(qc)$, if $q$ is the rank of root of $T$. The height of $T$ is in turn at most $ \log(n)/c $. 
The other inclusion applies to all kinds of binary search trees.
\end{myproof}

\begin{defn}
A ranked tree is said to be {\em Weak AVL tree} if all its vertices are either $(1,1), (1,2), (2,1)$ or $(2,2)$ and all leaves are of rank 0.
\end{defn}

\subsection{Bottom-up rebalancing}

\input{figures/insert-steps}

\input{figures/demote-first-kind}

\input{figures/demote-second-kind}

%TODO: discuss operations

We get the following as a corollary of theorem \ref{thm-rbt-depth}.

\begin{prop}
Insertion and deletion on a Weak AVL tree have time complexity $\Theta(\log n)$ and require at most one rotation.
\end{prop}

WAVL trees also have good properties when we consider the amortized number of promote, demote, or rotate steps -- all average to a constant. Unfortunately, we will need constant number of modifications per operation even in the worst-case.

\subsection{Top-down rebalancing}

There is an alternative set of procedures for performing insert and delete in WAVL tree. Changes are performed during descent from the root while searching for the key in question. No return to the root ensues.

For insert, we know that problematic vertices that cause promote to be passed upwards are (2,2). When we traverse the tree down from the root, passing through a vertex other than (2,2) ensures that rebalancing will not proceed through that vertex upwards. We thus only need to worry about long chains of (2,2)-vertices.

Before moving to our modification of this algorithm, we list a property of WAVL trees that will be useful later. The proof is beyond the scope of this thesis and can be found an article by Haeupler, Sen, and Tarjan \cite{rank-balanced-trees}. These results are obtained by cleverly defining a potential function on vertices of the BST.

\begin{defn}
Insert and delete operation is said to be of rank $r$ if the highest rank of a vertex where rotation or rank change takes place is $r$.
\end{defn}

\begin{prop}
There exist a constant $c_1$ greater than 1 such that for every ... %TODO: Some of the theorems from rbt article, probably without proofs.
\end{prop}